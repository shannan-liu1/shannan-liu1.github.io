---
layout: post
title:  "Movie Recommendation System Based on Actors"
categories: blog assignment
permalink: posts/HW-2
author: Shannan Liu
---

## Introduction
In this project, I create a web scraper that recommends movies or TV shows to users. A movie or TV show is recommended if a high number of actors in your current favorite movie or TV show also perform in it.

To demonstrate how my web scraper works, I will use my favourite movie as an example. My favorite movie is interstellar, which can be found here: https://www.imdb.com/title/tt0816692/

Here is the link to the web scraper project's repository: https://github.com/shannan-liu1/movie-recommender

## 1. Initialize your project
1. To begin, either clone the web scraper repository linked above or create a new GitHub repository
2. Open a terminal in the location of your repository on your laptop, and type:
```python
scrapy startproject IMDB_scraper
cd IMDB_scraper
```
3. Open imdb_spider.py

## How to use this project
### 1.1. Locate the Starting IMDB Page
Pick your favorite movie or TV show, and locate its IMDB page. For example, my favorite TV show is Interstellar. Its IMDB page is at: https://www.imdb.com/title/tt0816692/

### 1.2. Put the link into imdb_spider.py file
We will put this link into the `imdb_spider.py` file as shown below:
```python
# to run
# scrapy crawl imdb_spider -o movies.csv

import scrapy

class ImdbSpider(scrapy.Spider):
    name = 'imdb_spider'

    start_urls = ['https://www.imdb.com/title/tt0816692/']
```

### 1.3. Run this terminal command
Then (1) open your terminal, (2) navigate to the directory containing the web scraper, and (3) run "scrapy crawl imdb_spider -o movies.csv" in the terminal to get your movie recommendations!

Below, I'll discuss the implementation of this project

## Project implementation
```python
def parse(self,response):
  """
  assumes we start on a movie page, then
  navigates to "All Cast & Crew" page
  """
  next_page = f"{response.url}fullcredits/"
  #print(next_page)
  #next_page = response.urljoin(next_page)
  yield scrapy.Request(next_page, callback=self.parse_full_credits)
```
Our web scraper will begin on the IMDB page of our favorite movie/TV show. The `parse()` method we've created will take us from this starting page to the All Cast & Crew page, containing the names and links to all of the actors who performed in the movie.

Once on the All Cast & Crew page, we execute the method `parse_full_credits()`, shown below:
```python
def parse_full_credits(self, response):
  # get links for each actor's imdb page
  links = [a.attrib["href"] for a in response.css("td.primary_photo a")]

  # go through each actor's link and run the function "parse_actor_page"
  for link in links:
      yield scrapy.Request(f'https://www.imdb.com/{link}',
                          callback = self.parse_actor_page)
```

This method will collect the links to each actor's individual IMDB page. Then it will take us to each actor's page, in which we will execute the `parse_actor_page()` method.

```python
def parse_actor_page(self, response):
      """yield the actor's name and all the movies or TV shows they've done"""

      # get actor's name
      actor = response.css("td h1.header span.itemprop::text").get()
      # get all the movies and tv shows they've worked on
      movies_and_shows = response.css("div.filmo-row b a::text").getall()

      # create a dictionary for each of the movies
      # and shows that actors have worked on
      for i in movies_and_shows:
          yield {"actor" : actor,
          "movie_or_TV_name" : i}
```

Each actor's IMBD page has a list all of the movies and TV shows that they have acted in or will be acting in. The `parse_actor_page()` collects all of that information and stores it in a csv file for us.

After we get the CSV file, we can fun the following code to get our recommendations

## Table
| Movie or TV Show                       |   Actor |
|:---------------------------------------|--------:|
| Interstellar                           |      45 |
| Entertainment Tonight                  |      26 |
| Celebrity Page                         |      19 |
| The Oscars                             |      19 |
| Inside 'Interstellar'                  |      17 |
| Saturday Night Live                    |      15 |
| The Tonight Show Starring Jimmy Fallon |      14 |
| Made in Hollywood                      |      14 |
| Live with Kelly and Ryan               |      13 |
| Good Morning America                   |      13 |
| The Late Show with Stephen Colbert     |      12 |
| Jimmy Kimmel Live!                     |      12 |
| Extra with Billy Bush                  |      12 |
| The Late Late Show with James Corden   |      11 |
| Midnight Butterflies                   |      11 |
